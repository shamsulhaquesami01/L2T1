-----------------CHAPTER 06 (SUB QUERY)-------------------

SELECT LAST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY >
(
SELECT SALARY
FROM EMPLOYEES
WHERE LAST_NAME = 'Abel' -- unique chilo lastname
) ;   --where e sub query; amonvabe dite hobe jeno ekta row return kore.


SELECT LAST_NAME, SALARY
FROM EMPLOYEES
WHERE JOB_ID =
(
SELECT JOB_ID
FROM EMPLOYEES
WHERE EMPLOYEE_ID = 141  --this query returns one row
) ;  


SELECT LAST_NAME, SALARY
FROM EMPLOYEES
WHERE JOB_ID =
(
SELECT JOB_ID
FROM EMPLOYEES
WHERE EMPLOYEE_ID = 141
)
AND SALARY >
(
SELECT SALARY
FROM EMPLOYEES
WHERE LAST_NAME = 'Abel'
) ;


SELECT LAST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY =
(
SELECT MAX(SALARY)  --still return one row
FROM EMPLOYEES
) ;


--any and all for multiple rows to make them single

SELECT LAST_NAME, JOB_ID, SALARY
FROM EMPLOYEES
WHERE JOB_ID <> 'IT_PROG'
AND SALARY < ANY
(
SELECT SALARY
FROM EMPLOYEES
WHERE JOB_ID = 'IT_PROG'
) ;


SELECT LAST_NAME, JOB_ID, SALARY
FROM EMPLOYEES
WHERE JOB_ID <> 'IT_PROG' AND SALARY < ALL
(
SELECT SALARY
FROM EMPLOYEES
WHERE JOB_ID = 'IT_PROG'
) ;



--------------------exercise 6.2----


--retrieve those employees whose salary is higher than at least three other employees
SELECT *
FROM EMPLOYEES E1
WHERE 3 <= (
SELECT COUNT(*)
FROM EMPLOYEES E2
WHERE E2.SALARY < E1.SALARY
) ;


SELECT DEPARTMENT_NAME
FROM DEPARTMENTS D
WHERE EXISTS
(
SELECT *
FROM EMPLOYEES E
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID AND JOB_ID = 'IT_PROG'
) ;


--find those employees whose earns the maximum salary in his/her department
SELECT LAST_NAME, SALARY, DEPARTMENT_ID
FROM EMPLOYEES E1
WHERE NOT EXISTS
(
SELECT *
FROM EMPLOYEES E2
WHERE E2.DEPARTMENT_ID = E1.DEPARTMENT_ID AND
E2.SALARY > E1.SALARY
) ;

--same thing kintu select e sub query diye dept naame tao dekhano jabe
SELECT LAST_NAME, SALARY, (SELECT DEPARTMENT_NAME FROM DEPARTMENTS D
WHERE D.DEPARTMENT_ID = E1.DEPARTMENT_ID)
DEPARTMENT
FROM EMPLOYEES E1
WHERE NOT EXISTS
(
SELECT *
FROM EMPLOYEES E2
WHERE E2.DEPARTMENT_ID = E1.DEPARTMENT_ID AND
E2.SALARY > E1.SALARY
) ;


